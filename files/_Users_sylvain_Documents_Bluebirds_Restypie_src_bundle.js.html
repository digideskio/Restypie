<!DOCTYPE html>
<html lang="en" class="yui-overrride">
<head>
    <meta charset="utf-8">
    <title>/Users/sylvain/Documents/Bluebirds/Restypie/src/bundle.js - NodeToolkit</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1 class="blue-main-title">NodeToolkit</h1>
        </div>
        <div class="yui3-u-1-4 version project-version">
            API Docs for: 0.1.2
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Restypie.API.html">Restypie.API</a></li>
                                <li><a href="../classes/Restypie.BasicRoutes.html">Restypie.BasicRoutes</a></li>
                                <li><a href="../classes/Restypie.BasicRoutes.DeleteSingleRoute.html">Restypie.BasicRoutes.DeleteSingleRoute</a></li>
                                <li><a href="../classes/Restypie.BasicRoutes.GetManyRoute.html">Restypie.BasicRoutes.GetManyRoute</a></li>
                                <li><a href="../classes/Restypie.BasicRoutes.GetSingleRoute.html">Restypie.BasicRoutes.GetSingleRoute</a></li>
                                <li><a href="../classes/Restypie.BasicRoutes.OptionsRoute.html">Restypie.BasicRoutes.OptionsRoute</a></li>
                                <li><a href="../classes/Restypie.BasicRoutes.PatchSingleRoute.html">Restypie.BasicRoutes.PatchSingleRoute</a></li>
                                <li><a href="../classes/Restypie.BasicRoutes.PostRoute.html">Restypie.BasicRoutes.PostRoute</a></li>
                                <li><a href="../classes/Restypie.BasicRoutes.PutSingleRoute.html">Restypie.BasicRoutes.PutSingleRoute</a></li>
                                <li><a href="../classes/Restypie.Bundle.html">Restypie.Bundle</a></li>
                                <li><a href="../classes/Restypie.Codes.html">Restypie.Codes</a></li>
                                <li><a href="../classes/Restypie.Fields.html">Restypie.Fields</a></li>
                                <li><a href="../classes/Restypie.Fields.AbstractField.html">Restypie.Fields.AbstractField</a></li>
                                <li><a href="../classes/Restypie.Fields.AbstractNumberField.html">Restypie.Fields.AbstractNumberField</a></li>
                                <li><a href="../classes/Restypie.Fields.AbstractRelationField.html">Restypie.Fields.AbstractRelationField</a></li>
                                <li><a href="../classes/Restypie.Fields.AnyField.html">Restypie.Fields.AnyField</a></li>
                                <li><a href="../classes/Restypie.Fields.BooleanField.html">Restypie.Fields.BooleanField</a></li>
                                <li><a href="../classes/Restypie.Fields.DateField.html">Restypie.Fields.DateField</a></li>
                                <li><a href="../classes/Restypie.Fields.FileField.html">Restypie.Fields.FileField</a></li>
                                <li><a href="../classes/Restypie.Fields.FloatField.html">Restypie.Fields.FloatField</a></li>
                                <li><a href="../classes/Restypie.Fields.IntegerField.html">Restypie.Fields.IntegerField</a></li>
                                <li><a href="../classes/Restypie.Fields.StringField.html">Restypie.Fields.StringField</a></li>
                                <li><a href="../classes/Restypie.Fields.ToManyField.html">Restypie.Fields.ToManyField</a></li>
                                <li><a href="../classes/Restypie.Fields.ToOneField.html">Restypie.Fields.ToOneField</a></li>
                                <li><a href="../classes/Restypie.Methods.html">Restypie.Methods</a></li>
                                <li><a href="../classes/Restypie.Operators.html">Restypie.Operators</a></li>
                                <li><a href="../classes/Restypie.Operators.AbstractListOperator.html">Restypie.Operators.AbstractListOperator</a></li>
                                <li><a href="../classes/Restypie.Operators.AbstractOperator.html">Restypie.Operators.AbstractOperator</a></li>
                                <li><a href="../classes/Restypie.Operators.Eq.html">Restypie.Operators.Eq</a></li>
                                <li><a href="../classes/Restypie.Operators.Gt.html">Restypie.Operators.Gt</a></li>
                                <li><a href="../classes/Restypie.Operators.Gte.html">Restypie.Operators.Gte</a></li>
                                <li><a href="../classes/Restypie.Operators.In.html">Restypie.Operators.In</a></li>
                                <li><a href="../classes/Restypie.Operators.Lt.html">Restypie.Operators.Lt</a></li>
                                <li><a href="../classes/Restypie.Operators.Lte.html">Restypie.Operators.Lte</a></li>
                                <li><a href="../classes/Restypie.Operators.Ne.html">Restypie.Operators.Ne</a></li>
                                <li><a href="../classes/Restypie.Operators.Nin.html">Restypie.Operators.Nin</a></li>
                                <li><a href="../classes/Restypie.Resources.html">Restypie.Resources</a></li>
                                <li><a href="../classes/Restypie.Resources.AbstractResource.html">Restypie.Resources.AbstractResource</a></li>
                                <li><a href="../classes/Restypie.Resources.FixturesResource.html">Restypie.Resources.FixturesResource</a></li>
                                <li><a href="../classes/Restypie.Resources.ProxyResource.html">Restypie.Resources.ProxyResource</a></li>
                                <li><a href="../classes/Restypie.Resources.SequelizeResource.html">Restypie.Resources.SequelizeResource</a></li>
                                <li><a href="../classes/Restypie.RestErrors.html">Restypie.RestErrors</a></li>
                                <li><a href="../classes/Restypie.RestErrors.AbstractRestError.html">Restypie.RestErrors.AbstractRestError</a></li>
                                <li><a href="../classes/Restypie.RestErrors.BadRequest.html">Restypie.RestErrors.BadRequest</a></li>
                                <li><a href="../classes/Restypie.RestErrors.Forbidden.html">Restypie.RestErrors.Forbidden</a></li>
                                <li><a href="../classes/Restypie.RestErrors.InternalServerError.html">Restypie.RestErrors.InternalServerError</a></li>
                                <li><a href="../classes/Restypie.RestErrors.NotAcceptable.html">Restypie.RestErrors.NotAcceptable</a></li>
                                <li><a href="../classes/Restypie.RestErrors.NotFound.html">Restypie.RestErrors.NotFound</a></li>
                                <li><a href="../classes/Restypie.RestErrors.NotImplemented.html">Restypie.RestErrors.NotImplemented</a></li>
                                <li><a href="../classes/Restypie.RestErrors.Unauthorized.html">Restypie.RestErrors.Unauthorized</a></li>
                                <li><a href="../classes/Restypie.RestErrors.UnsupportedMediaType.html">Restypie.RestErrors.UnsupportedMediaType</a></li>
                                <li><a href="../classes/Restypie.Route.html">Restypie.Route</a></li>
                                <li><a href="../classes/Restypie.RoutesSorter.html">Restypie.RoutesSorter</a></li>
                                <li><a href="../classes/Restypie.Serializers.html">Restypie.Serializers</a></li>
                                <li><a href="../classes/Restypie.Serializers.AbstractSerializer.html">Restypie.Serializers.AbstractSerializer</a></li>
                                <li><a href="../classes/Restypie.Serializers.JSONSerializer.html">Restypie.Serializers.JSONSerializer</a></li>
                                <li><a href="../classes/Restypie.TemplateErrors.html">Restypie.TemplateErrors</a></li>
                                <li><a href="../classes/Restypie.Url.html">Restypie.Url</a></li>
                                <li><a href="../classes/Restypie.Utils.html">Restypie.Utils</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: /Users/sylvain/Documents/Bluebirds/Restypie/src/bundle.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x27;use strict&#x27;;

/***********************************************************************************************************************
 * Dependencies
 **********************************************************************************************************************/
let _ = require(&#x27;lodash&#x27;);
let QS = require(&#x27;querystring&#x27;);

let Restypie = require(&#x27;./&#x27;);

/***********************************************************************************************************************
 * @namespace Restypie
 * @class Bundle
 * @constructor
 **********************************************************************************************************************/
module.exports = class Bundle {

  get req() { return this._req; }

  get res() { return this._res; }

  get body() { return this._body; }

  get query() { return this._query; }

  get params() { return this._params; }

  get headers() { return this._headers; }

  get populate() { return this._populate; }

  get statusCode() { return this._statusCode; }
  get limit() { return this._limit; }
  get offset() { return this._offset; }

  get isError() { return this._isError; }

  get meta() { return this._meta; }

  get data() { return this._data; }

  get code() { return this._code; }
  get format() { return this._format; }

  get filters() { return this._filters; }
  get select() { return this._select; }
  get sort() { return this._sort; }

  get isRead() { return this._isRead; }
  get isUpdate() { return this._isUpdate; }
  get isWrite() { return this._isWrite; }
  get isDelete() { return this._isDelete; }

  next(err) {
    return err ? Promise.reject(err) : Promise.resolve(this);
  }

  get payload() {
    let defaultPayload = _.pick({
      error: this._isError,
      message: this._message,
      code: this._code,
      meta: this._meta,
      data: this._data
    }, function (val) {
      return !_.isUndefined(val);
    });
    return Object.assign(defaultPayload, this._payload || {});
  }

  constructor(options) {
    this._req = options.req;
    this._res = options.res;
    this._query = this._req.query;
    this._body = {};
    this._params = this._req.params;
    this._headers = {};
    this._statusCode = Restypie.Codes.Accepted;

    switch (this._req.method) {
      case &#x27;POST&#x27;:
        this._isWrite = true;
        break;
      case &#x27;DELETE&#x27;:
        this._isDelete = true;
        break;
      case &#x27;PATCH&#x27;:
        this._isUpdate = true;
        break;
      case &#x27;GET&#x27;:
        this._isRead = true;
        break;
      case &#x27;PUT&#x27;:
        this._isWrite = true;
        break;
      default:
        this._isRead = true;
    }

    this.emptyPayload();
  }

  setData(data) {
    this._data = data;
    return this;
  }

  setPayload(payload) {
    this._payload = payload;
    return this;
  }

  assignToPayload(obj) {
    if (!this._payload) this._payload = {};
    Object.assign(this._payload, obj);
    return this;
  }

  assignToHeaders(obj) {
    Object.assign(this._headers, obj);
    return this;
  }

  resetPayload() {
    this._payload = undefined;
    return this;
  }

  emptyPayload() {
    this._isError = undefined;
    this._meta = undefined;
    this._data = undefined;
    this._code = undefined;
    this._message = undefined;
    return this;
  }

  assignToQuery(obj) {
    Object.assign(this._query, obj);
    return this;
  }

  setStatusCode(statusCode) {
    this._statusCode = statusCode;
    return this;
  }

  setQuery(query) {
    this._query = query;
    return this;
  }

  setMessage(message) {
    this._message = message;
    return this;
  }

  setCode(code) {
    this._code = code;
    return this;
  }

  setError(err) {
    err = Restypie.RestErrors.toRestError(err);
    this.err = err;
    this.resetPayload()
      .emptyPayload()
      .setStatusCode(err.statusCode)
      .setMessage(err.message)
      .setCode(err.code || err.name)
      .setMeta(err.meta);
    this._isError = true;
    return this;
  }

  assignToMeta(key, value) {
    if (!_.isPlainObject(this._meta)) this._meta = {};
    if (_.isPlainObject(key)) Object.assign(this._meta, key);
    else this._meta[key] = value;
    return this;
  }

  setMeta(obj) {
    this._meta = obj;
    return this;
  }

  setPopulate(fields) {
    this._populate = Array.isArray(fields) ? fields : [fields];
    return this;
  }

  setSelect(select) {
    this._select = Array.isArray(select) ? select : [select];
  }


  setLimit(value) {
    this._limit = value;
    return this;
  }

  setOffset(value) {
    this._offset = value;
    return this;
  }

  setFormat(format) {
    this._format = format;
    return this;
  }

  setFilters(filters) {
    this._filters = filters;
    return this;
  }

  setBody(body) {
    this._body = body;
    return this;
  }

  setSort(fields) {
    this._sort = Array.isArray(fields) ? fields : [fields];
    return this;
  }

  /**
   * Builds navigation links.
   *
   * @method getNavLinks
   * @param {Number} total
   * @return {Object}
   */
  getNavLinks(total) {
    if (!_.isNumber(total)) throw new TypeError(&#x60;getNavLinks expects a number, got ${total}&#x60;);

    let limit = this.limit;
    let offset = this.offset;

    let next = null;
    let prev = null;

    let nextOffset = offset + limit;
    let prevOffset = offset - limit;

    if (nextOffset &lt; total) next = this._getNavLink(limit, nextOffset);
    if (prevOffset &gt;= 0 &amp;&amp; prevOffset &lt; total) prev = this._getNavLink(limit, prevOffset);

    return { next: next, prev: prev };
  }


  _getNavLink(limit, offset) {
    let queryString = QS.stringify(Object.assign({}, this.query, { limit: limit, offset: offset }));
    return this.req._parsedUrl.pathname + &#x27;?&#x27; + QS.unescape(queryString);
  }

};
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
